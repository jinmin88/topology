<!doctype html>

<html>
<head>
    <title>Tutorial 1: Getting Started</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
    <link href="css/cytoscape.js-panzoom.css" rel="stylesheet" type="text/css" />
    <link href="font-awesome-4.0.3/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <script src="js/jquery-2.0.3.min.js"></script>
    <script src="js/cytoscape.min.js"></script>
    <script src="js/cytoscape-panzoom.js"></script>
</head>

<style>
    body {
        font-family: helvetica;
        font-size: 14px;
    }

    #cy {
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
        z-index: 1;
    }

    h1 {
        opacity: 0.5;
        font-size: 1em;
    }
</style>

<body>
    <div id="cy"></div>
    <div id="tooltip" style="position: absolute; display: none; background: #e0e0e0; border: 1px solid black; padding: 10px; border-radius: 5px; pointer-events: none; z-index: 10;"></div>
    <script>
        topology_data = {
            nodes: [{
                data: {
                    id: "RT_CORE_0",
                    ip: '10.1.1.255',
                    tyoe: 'router'
                }
            },{
                data: {
                    id: 'AGG_1',
                    ip: '10.1.1.1',
                    type: 'agg'
                }
            },{
                data: {
                    id: 'AGG_2',
                    ip: '10.1.1.2',
                    type: 'agg'
                }
            },
            {
                data: {
                    id: 'AGG_3',
                    ip: '10.1.1.3',
                    type: 'agg'
                }
            },
            {
                data: {
                    id: 'EDGE_1',
                    ip: '10.1.1.4',
                    type: 'edge'
                }
            },
            {
                data: {
                    id: 'EDGE_2',
                    ip: '10.1.1.5',
                    type: 'edge'
                }
            },
            {
                data: {
                    id: 'EDGE_3',
                    ip: '10.1.1.6',
                    type: 'edge'
                }
            },
            {
                data: {
                    id: 'EDGE_4',
                    ip: '10.1.1.7',
                    type: 'edge'
                }
            },
            {
                data: {
                    id: 'EDGE_5',
                    ip: '10.1.1.8',
                    type: 'edge'
                }
            },
            {
                data: {
                    id: 'EDGE_6',
                    ip: '10.1.1.9',
                    type: 'edge'
                }
            },
            {
                data: {
                    id: 'EDGE_7',
                    ip: '10.1.1.10',
                    type: 'edge'
                }
            },
            {
                data: {
                    id: 'EDGE_8',
                    ip: '10.1.1.11',
                    type: 'edge'
                }
            },
            {
                data: {
                    id: 'EDGE_9',
                    ip: '10.1.1.12',
                    type: 'edge'
                }
            },{
                data: {
                    id: "RT_CORE_1",
                    ip: '10.1.2.255',
                    tyoe: 'router'
                }
            },{
                data: {
                    id: 'AGG_4',
                    ip: '10.1.1.1',
                    type: 'agg'
                }
            },{
                data: {
                    id: 'AGG_5',
                    ip: '10.1.1.2',
                    type: 'agg'
                }
            },
            {
                data: {
                    id: 'AGG_6',
                    ip: '10.1.1.3',
                    type: 'agg'
                }
            }],
            edges:[{
                data: {
                    source: 'RT_CORE_0',
                    target: 'AGG_1',
                    source_interface: 'Eth1/1',
                    target_interface: 'Eth1/30'
                }
            },{
                data: {
                    source: 'RT_CORE_0',
                    target: 'RT_CORE_1',
                    source_interface: 'Eth1/1',
                    target_interface: 'Eth1/30'
                }
            },{
                data: {
                    source: 'RT_CORE_0',
                    target: 'AGG_2',
                    source_interface: 'Eth1/2',
                    target_interface: 'Eth1/31'
                }
            },{
                data: {
                    source: 'RT_CORE_1',
                    target: 'AGG_4',
                    source_interface: 'Eth1/1',
                    target_interface: 'Eth1/30'
                }
            },{
                data: {
                    source: 'RT_CORE_1',
                    target: 'AGG_5',
                    source_interface: 'Eth1/1',
                    target_interface: 'Eth1/30'
                }
            },{
                data: {
                    source: 'RT_CORE_1',
                    target: 'AGG_6',
                    source_interface: 'Eth1/1',
                    target_interface: 'Eth1/30'
                }
            },{
                data: {
                    source: 'RT_CORE_0',
                    target: 'AGG_3',
                    source_interface: 'Eth1/3',
                    target_interface: 'Eth1/32'
                }
            },{
                data:{
                    source: 'AGG_1',
                    target: 'EDGE_1',
                    source_interface: 'Eth1/2',
                    target_interface: 'Eth1/3' 
                }
            },{
                data:{
                    source: 'AGG_1',
                    target: 'EDGE_2',
                    source_interface: 'Eth1/3',
                    target_interface: 'Eth1/4' 
                }
            },{
                data:{
                    source: 'AGG_1',
                    target: 'EDGE_3',
                    source_interface: 'Eth1/4',
                    target_interface: 'Eth1/5' 
                }
            },{
                data:{
                    source: 'AGG_2',
                    target: 'EDGE_4',
                    source_interface: 'Eth1/2',
                    target_interface: 'Eth1/3' 
                }
            },{
                data:{
                    source: 'AGG_2',
                    target: 'EDGE_5',
                    source_interface: 'Eth1/3',
                    target_interface: 'Eth1/4' 
                }
            },{
                data:{
                    source: 'AGG_2',
                    target: 'EDGE_6',
                    source_interface: 'Eth1/4',
                    target_interface: 'Eth1/5' 
                }
            },{
                data:{
                    source: 'AGG_3',
                    target: 'EDGE_7',
                    source_interface: 'Eth1/2',
                    target_interface: 'Eth1/3' 
                }
            },{
                data:{
                    source: 'AGG_3',
                    target: 'EDGE_8',
                    source_interface: 'Eth1/3',
                    target_interface: 'Eth1/4' 
                }
            },{
                data:{
                    source: 'AGG_3',
                    target: 'EDGE_9',
                    source_interface: 'Eth1/4',
                    target_interface: 'Eth1/5' 
                }
            }]
        }

        
        let layout_breadthfirst = {
            name: 'breadthfirst',
            fit: true, // whether to fit the viewport to the graph
            directed: false, // whether the tree is directed downwards (or edges can point in any direction if false)
            padding: 30, // padding on fit
            circle: false, // put depths in concentric circles if true, put depths top down if false
            grid: false, // whether to create an even grid into which the DAG is placed (circle:false only)
            spacingFactor: 1.75, // positive spacing factor, larger => more space between nodes (N.B. n/a if causes overlap)
            boundingBox: undefined, // constrain layout bounds; { x1, y1, x2, y2 } or { x1, y1, w, h }
            avoidOverlap: true, // prevents node overlap, may overflow boundingBox if not enough space
            nodeDimensionsIncludeLabels: false, // Excludes the label when calculating node bounding boxes for the layout algorithm
            roots: undefined, // the roots of the trees
            depthSort: undefined, // a sorting function to order nodes at equal depth. e.g. function(a, b){ return a.data('weight') - b.data('weight') }
            animate: false, // whether to transition the node positions
            animationDuration: 500, // duration of animation in ms if enabled
            animationEasing: undefined, // easing of animation if enabled,
            animateFilter: function ( node, i ){ return true; }, // a function that determines whether the node should be animated.  All nodes animated by default on animate enabled.  Non-animated nodes are positioned immediately when the layout starts
            ready: undefined, // callback on layoutready
            stop: undefined, // callback on layoutstop
            transform: function (node, position ){ return position; } // transform a given node position. Useful for changing flow direction in discrete layouts
        };
        let style_options = [
            {
                 selector: 'node',
                 style: {
                    'label': function (node) { 
                        return `${node.data("id")}\n${node.data("ip")}` 
                    },
                    'text-wrap': 'wrap'
                 }
            },
            {
                selector: 'edge',
                style: {
                    'line-color': '#ccc',
                    'curve-style': 'bezier',                   
                    'source-label': 'data(source_interface)',
                    'source-text-offset': 60,
                    'target-label': 'data(target_interface)',
                    'target-text-offset': 60,
                    'text-opacity': .5
                }
            }
        ]
        layout_breadthfirst.roots = ['RT_CORE_0', 'RT_CORE_1']  //fill start node
        var cy = cytoscape({
            container: document.getElementById('cy'),
            elements: topology_data,
            layout: layout_breadthfirst,
            style: style_options
        });
        // the default values of each option are outlined below:
        var defaults = {
            zoomFactor: 0.05, // zoom factor per zoom tick
            zoomDelay: 45, // how many ms between zoom ticks
            minZoom: 0.1, // min zoom level
            maxZoom: 10, // max zoom level
            fitPadding: 50, // padding when fitting
            panSpeed: 10, // how many ms in between pan ticks
            panDistance: 10, // max pan distance per tick
            panDragAreaSize: 75, // the length of the pan drag box in which the vector for panning is calculated (bigger = finer control of pan speed and direction)
            panMinPercentSpeed: 0.25, // the slowest speed we can pan by (as a percent of panSpeed)
            panInactiveArea: 8, // radius of inactive area in pan drag box
            panIndicatorMinOpacity: 0.5, // min opacity of pan indicator (the draggable nib); scales from this to 1.0
            zoomOnly: false, // a minimal version of the ui only with zooming (useful on systems with bad mousewheel resolution)

            // icon class names
            sliderHandleIcon: 'fa fa-minus',
            zoomInIcon: 'fa fa-plus',
            zoomOutIcon: 'fa fa-minus',
            resetIcon: 'fa fa-expand'
        };

        cy.panzoom( defaults );
        cy.on('mouseover', 'node', function(event) {
            var node = event.target;
            var tooltipDiv = document.getElementById('tooltip');
            // Show the tooltip with node information
            tooltipDiv.innerHTML = 'Name: ' + node.data('id') + '<br>IP: ' + node.data('ip');
            tooltipDiv.style.display = 'block';
            tooltipDiv.style.left = event.renderedPosition.x + 'px';
            tooltipDiv.style.top = event.renderedPosition.y + 'px';
        });
        // cy.on('mouseover', 'edge', function(event) {
        //     var edge = event.target;
        //     var tooltipDiv = document.getElementById('tooltip')

        //     // Show the tooltip with node information
        //     tooltipDiv.innerHTML = 'source: ' + edge.data('source') + '<br/>source interface: ' + edge.data('source_interface') + '<br/>target: ' + edge.data('target') + '<br/>target_interface: ' + edge.data('target_interface')
        //     tooltipDiv.style.display = 'block';
        //     tooltipDiv.style.left = event.renderedPosition.x + 'px';
        //     tooltipDiv.style.top = event.renderedPosition.y + 'px';
        // })

        cy.on('mouseout', 'node', function() {
            var tooltipDiv = document.getElementById('tooltip');
            tooltipDiv.style.display = 'none';
        });
        // cv.on('mouseout', 'edge', function() {
        //     var tooltipDiv = document.getElementById('tooltip');
        //     tooltipDiv.style.display = 'none'
        // })
        

    </script>
</body>
</html>